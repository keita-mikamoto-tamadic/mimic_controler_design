# 3D ãƒ•ãƒ«ãƒ­ãƒœãƒƒãƒˆç·šå½¢è¿‘ä¼¼çŠ¶æ…‹æ–¹ç¨‹å¼åŒ–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

### ç›®çš„
`fixed_robot_3d.py`ã§å®Ÿè£…ã•ã‚ŒãŸ3æ¬¡å…ƒäºŒè¶³æ­©è¡Œãƒ­ãƒœãƒƒãƒˆã®éç·šå½¢å‹•åŠ›å­¦ã‚’å¹³è¡¡ç‚¹å‘¨ã‚Šã§ç·šå½¢è¿‘ä¼¼ã—ã€å¹¾ä½•å­¦çš„æ‹˜æŸã‚’è€ƒæ…®ã—ãŸç¸®ç´„çŠ¶æ…‹ç©ºé–“ãƒ¢ãƒ‡ãƒ«ã¨ã—ã¦ç¾ä»£åˆ¶å¾¡ç†è«–ã§æ‰±ãˆã‚‹çŠ¶æ…‹æ–¹ç¨‹å¼å½¢å¼ã«å¤‰æ›ã™ã‚‹ã€‚

### èƒŒæ™¯
- **éç·šå½¢ã‚·ã‚¹ãƒ†ãƒ **: 10è‡ªç”±åº¦ï¼ˆç‹¬ç«‹å¤‰æ•°ï¼‰ã®éç·šå½¢å‹•åŠ›å­¦
- **ç·šå½¢è¿‘ä¼¼**: å¹³è¡¡ç‚¹å‘¨ã‚Šã®ãƒ†ã‚¤ãƒ©ãƒ¼å±•é–‹ã«ã‚ˆã‚‹1æ¬¡è¿‘ä¼¼ï¼ˆCasADiä½¿ç”¨ï¼‰
- **å¹¾ä½•å­¦çš„æ‹˜æŸ**: é–¢ç¯€é–“æ‹˜æŸ `theta2 = -2 * theta1` ã‚’è€ƒæ…®ã—ãŸç¸®ç´„ãƒ¢ãƒ‡ãƒ«
- **åˆ¶å¾¡ç†è«–å¿œç”¨**: LQRåˆ¶å¾¡ã€æ¥µé…ç½®ã€çŠ¶æ…‹ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åˆ¶å¾¡ã¸ã®åŸºç›¤æ§‹ç¯‰

### ç‰¹æ®Šè¦ä»¶ï¼ˆ`urdf/01_ApproximationModel.md`æº–æ‹ ï¼‰
- **å¹³è¡¡ç‚¹**: upper=52deg, lower=-104degï¼ˆæ‹˜æŸé–¢ä¿‚ã‚’æº€ãŸã™ï¼‰
- **ãƒˆãƒ«ã‚¯æ‹˜æŸ**: `tau2 = f(theta1) * tau1`ã®ç·šå½¢è¿‘ä¼¼é©ç”¨
- **ç·šå½¢å¤‰æ›**: A,Bè¡Œåˆ—å°å‡ºå¾Œã®çŠ¶æ…‹ãƒ»å…¥åŠ›å¤‰æ›ã«ã‚ˆã‚‹ç¸®ç´„ãƒ¢ãƒ‡ãƒ«æ§‹ç¯‰

## ã‚·ã‚¹ãƒ†ãƒ ä»•æ§˜

### å…ƒã‚·ã‚¹ãƒ†ãƒ ï¼ˆfixed_robot_3d.pyï¼‰
```python
# ç‹¬ç«‹å¤‰æ•°ï¼ˆ10DOFï¼‰
state = [x_base, y_base, pitch, yaw, phi_L_lower, phi_R_lower, phi_L_upper, phi_R_upper, wheel_L, wheel_R]

# å¾“å±å¤‰æ•°ï¼ˆæ‹˜æŸã‹ã‚‰æ±ºå®šï¼‰
dependent = [z_base, roll]  # æ¥åœ°æ‹˜æŸã‹ã‚‰è¨ˆç®—
```

### çŠ¶æ…‹å¤‰æ•°å®šç¾©
```python
# çŠ¶æ…‹ãƒ™ã‚¯ãƒˆãƒ« x âˆˆ R^20
x = [Î”q, Î”dq]^T

# Î”q: å¹³è¡¡ç‚¹ã‹ã‚‰ã®ä½ç½®åå·®ï¼ˆ10æ¬¡å…ƒï¼‰
Î”q = [Î”x_base, Î”y_base, Î”pitch, Î”yaw, Î”phi_L_lower, Î”phi_R_lower, Î”phi_L_upper, Î”phi_R_upper, Î”wheel_L, Î”wheel_R]

# Î”dq: å¹³è¡¡ç‚¹ã‹ã‚‰ã®é€Ÿåº¦åå·®ï¼ˆ10æ¬¡å…ƒï¼‰
Î”dq = [Î”dx_base, Î”dy_base, Î”dpitch, Î”dyaw, Î”dphi_L_lower, Î”dphi_R_lower, Î”dphi_L_upper, Î”dphi_R_upper, Î”dwheel_L, Î”dwheel_R]
```

### ç·šå½¢çŠ¶æ…‹æ–¹ç¨‹å¼
```python
# dx/dt = Ax + Bu
# y = Cx + Du

# A âˆˆ R^(20Ã—20): ã‚·ã‚¹ãƒ†ãƒ è¡Œåˆ—
# B âˆˆ R^(20Ã—m): å…¥åŠ›è¡Œåˆ—ï¼ˆm=åˆ¶å¾¡å…¥åŠ›æ•°ï¼‰
# C âˆˆ R^(pÃ—20): å‡ºåŠ›è¡Œåˆ—ï¼ˆp=è¦³æ¸¬å‡ºåŠ›æ•°ï¼‰
# D âˆˆ R^(pÃ—m): ç›´é”é …
```

## å®Ÿè£…çŠ¶æ³

### âœ… å®Ÿè£…å®Œäº†é …ç›®

#### Phase 1: å¹³è¡¡ç‚¹æ¢ç´¢ï¼ˆequilibrium_finder.pyï¼‰- **å®Œäº†**
- âœ… æŒ‡å®šå¹³è¡¡ç‚¹(upper=52deg, lower=-104deg)ã§ã®æ§‹æˆè¨ˆç®—
- âœ… å¹¾ä½•å­¦çš„æ‹˜æŸ `theta2 = -2 * theta1` å®Œå…¨æº€è¶³ç¢ºèª
- âœ… é‡åŠ›è£œå„Ÿãƒˆãƒ«ã‚¯è¨ˆç®—: ||tau|| = 2.103358 Nm

#### Phase 2: ç·šå½¢åŒ–å®Ÿè£…ï¼ˆlinearized_dynamics.py, linearized_dynamics_simple.pyï¼‰- **å®Œäº†**
- âœ… CasADiè‡ªå‹•å¾®åˆ†ã«ã‚ˆã‚‹é«˜ç²¾åº¦ç·šå½¢åŒ–ï¼ˆãƒ¡ã‚¤ãƒ³å®Ÿè£…ï¼‰
- âœ… æ•°å€¤å¾®åˆ†ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç‰ˆï¼ˆä¾å­˜é–¢ä¿‚å•é¡Œå¯¾å¿œï¼‰
- âœ… 20Ã—20ã‚·ã‚¹ãƒ†ãƒ è¡Œåˆ—Aã€20Ã—10å…¥åŠ›è¡Œåˆ—Bå°å‡º

#### Phase 3: å¹¾ä½•å­¦çš„æ‹˜æŸç¸®ç´„ï¼ˆconstraint_reduction.pyï¼‰- **å®Œäº†**  
- âœ… çŠ¶æ…‹å¤‰æ›è¡Œåˆ—T: 20æ¬¡å…ƒâ†’16æ¬¡å…ƒ (80%ç¸®ç´„)
- âœ… å…¥åŠ›å¤‰æ›è¡Œåˆ—T_u: 10æ¬¡å…ƒâ†’8æ¬¡å…ƒ (80%ç¸®ç´„)
- âœ… ãƒˆãƒ«ã‚¯æ‹˜æŸç·šå½¢åŒ–: `tau2 = -8.229 * tau1`
- âœ… ç¸®ç´„çŠ¶æ…‹æ–¹ç¨‹å¼: `dz/dt = A_reduced*z + B_reduced*u`

#### Phase 4: åˆ¶å¾¡å¯èƒ½æ€§è§£æï¼ˆcontrollability_analysis.py, quick_controllability_test.pyï¼‰- **å®Œäº†**
- âœ… **ç¸®ç´„ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ16æ¬¡å…ƒï¼‰å®Œå…¨åˆ¶å¾¡å¯èƒ½ç¢ºèª**: ãƒ©ãƒ³ã‚¯16/16
- âœ… **æ¥µé…ç½®åˆ¶å¾¡å™¨è¨­è¨ˆæˆåŠŸ**: ä»»æ„å®‰å®šæ¥µã¸ã®é…ç½®å¯èƒ½
- âœ… **LQRåˆ¶å¾¡é©ç”¨å¯èƒ½æ€§ç¢ºèª**: ç¾ä»£åˆ¶å¾¡ç†è«–åŸºç›¤å®Œæˆ

#### Phase 5: çµ±åˆã‚·ã‚¹ãƒ†ãƒ ï¼ˆtest_linearization.pyï¼‰- **å®Œäº†**
- âœ… å…¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆçµ±åˆå‹•ä½œç¢ºèª
- âœ… æ¬¡å…ƒæ•´åˆæ€§ãƒ»æ‹˜æŸæº€è¶³ãƒ»ç·šå½¢åŒ–ç²¾åº¦æ¤œè¨¼

## å®Ÿè£…è¨ˆç”»ï¼ˆå½“åˆãƒ—ãƒ©ãƒ³ï¼‰

### Phase 1: å¹³è¡¡ç‚¹æ¢ç´¢ï¼ˆequilibrium_finder.pyï¼‰

#### 1.1 å¹³è¡¡ç‚¹æ¡ä»¶ï¼ˆ`urdf/01_ApproximationModel.md`æº–æ‹ ï¼‰
```python
# æŒ‡å®šå¹³è¡¡ç‚¹ï¼ˆdegï¼‰
upper_link_R_joint = 52  # deg
upper_link_L_joint = 52  # deg  
lower_link_R_joint = -104  # degï¼ˆæ‹˜æŸ: -2 * upperï¼‰
lower_link_L_joint = -104  # degï¼ˆæ‹˜æŸ: -2 * upperï¼‰

# å¹¾ä½•å­¦çš„æ‹˜æŸ
theta2 = -2 * theta1  # æ§‹é€ çš„æ‹˜æŸé–¢ä¿‚

# å‹•åŠ›å­¦å¹³è¡¡æ¡ä»¶
M(qâ‚€) * 0 = Ï„â‚€ - g(qâ‚€) - C(qâ‚€, 0)
# â‡’ Ï„â‚€ = g(qâ‚€)  (é‡åŠ›é …ã®ã¿)

# æ¥åœ°æ‹˜æŸæ¡ä»¶
# ãƒ›ã‚¤ãƒ¼ãƒ«ä¸­å¿ƒzåº§æ¨™ = wheel_radiusï¼ˆåœ°é¢ã‹ã‚‰ã®é«˜ã•ï¼‰
# body_z = é †é‹å‹•å­¦ã§è¨ˆç®—ã•ã‚Œã‚‹é©åˆ‡ãªã‚ªãƒ•ã‚»ãƒƒãƒˆä½ç½®
```

#### 1.2 å¹³è¡¡ç‚¹è¨ˆç®—ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
```python
def find_equilibrium_point():
    """
    æŒ‡å®šå¹³è¡¡ç‚¹ã§ã®å®Œå…¨æ§‹æˆè¨ˆç®—
    
    Returns:
        q_eq: å¹³è¡¡ç‚¹ä½ç½® (10æ¬¡å…ƒ)
        dq_eq: å¹³è¡¡ç‚¹é€Ÿåº¦ (10æ¬¡å…ƒ, å…¨ã¦ã‚¼ãƒ­)
        tau_eq: å¹³è¡¡ç‚¹åˆ¶å¾¡å…¥åŠ› (é‡åŠ›è£œå„Ÿ)
    """
    # æŒ‡å®šå¹³è¡¡ç‚¹ï¼ˆradå¤‰æ›ï¼‰
    upper_angle = np.deg2rad(52)
    lower_angle = np.deg2rad(-104)
    
    # åˆæœŸæ¨å®šå€¤: æŒ‡å®šç›´ç«‹å§¿å‹¢
    q_init = [0, 0, 0, 0, lower_angle, lower_angle, upper_angle, upper_angle, 0, 0]
    
    # fixed_robot_3d.pyã®æ‹˜æŸæº€è¶³è¨ˆç®—ã‚’ä½¿ç”¨
    # ãƒ›ã‚¤ãƒ¼ãƒ«æ¥åœ°æ¡ä»¶ã‚’æº€ãŸã™z_base, rollã‚’è¨ˆç®—
```

### Phase 2: ç·šå½¢åŒ–å®Ÿè£…ï¼ˆlinearized_dynamics.pyï¼‰

#### 2.1 CasADiä½¿ç”¨ã«ã‚ˆã‚‹è‡ªå‹•å¾®åˆ†
```python
import casadi as cs

def compute_linearization_matrices(robot, q_eq, dq_eq):
    """
    CasADiã‚’ä½¿ç”¨ã—ãŸå¹³è¡¡ç‚¹å‘¨ã‚Šã®ç·šå½¢åŒ–è¡Œåˆ—è¨ˆç®—
    
    Returns:
        A_full: ãƒ•ãƒ«ã‚·ã‚¹ãƒ†ãƒ è¡Œåˆ— (20Ã—20)
        B_full: ãƒ•ãƒ«å…¥åŠ›è¡Œåˆ— (20Ã—n_inputs)
    """
    # CasADiã‚·ãƒ³ãƒœãƒªãƒƒã‚¯å¤‰æ•°å®šç¾©
    q_sym = cs.SX.sym('q', 10)
    dq_sym = cs.SX.sym('dq', 10)
    tau_sym = cs.SX.sym('tau', n_inputs)
    
    # Pinocchioå‹•åŠ›å­¦ã®CasADié–¢æ•°åŒ–
    # f(x, u) = [dq; M^-1(Ï„ - g - C)]ã®å®Ÿè£…
    
    # è‡ªå‹•å¾®åˆ†ã«ã‚ˆã‚‹ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³è¨ˆç®—
    A_full = cs.jacobian(f_sym, cs.vertcat(q_sym, dq_sym))
    B_full = cs.jacobian(f_sym, tau_sym)
    
    # å¹³è¡¡ç‚¹ã§è©•ä¾¡
    A_full_eq = A_full(q_eq, dq_eq, tau_eq)
    B_full_eq = B_full(q_eq, dq_eq, tau_eq)
```

#### 2.2 ã‚·ã‚¹ãƒ†ãƒ è¡Œåˆ—æ§‹ç¯‰
```python
# éç·šå½¢å‹•åŠ›å­¦: M(q)ddq = Ï„ - g(q) - C(q,dq)
# çŠ¶æ…‹æ–¹ç¨‹å¼å½¢å¼: dx/dt = f(x, u)

# CasADiè‡ªå‹•å¾®åˆ†ã«ã‚ˆã‚‹ç·šå½¢åŒ–
# dx/dt = A_full*x + B_full*u
# A_full = [0_{10Ã—10}    I_{10Ã—10}     ]
#          [âˆ‚fâ‚‚/âˆ‚q|eq   âˆ‚fâ‚‚/âˆ‚dq|eq  ]
```

### Phase 3: ç·šå½¢å¤‰æ›ã«ã‚ˆã‚‹ç¸®ç´„ï¼ˆconstraint_reduction.pyï¼‰

#### 3.1 å¹¾ä½•å­¦çš„æ‹˜æŸå¤‰æ›è¡Œåˆ—
```python
def compute_constraint_transformation():
    """
    å¹¾ä½•å­¦çš„æ‹˜æŸ theta2 = -2 * theta1 ã‚’åæ˜ ã—ãŸå¤‰æ›è¡Œåˆ—Tè¨ˆç®—
    
    Returns:
        T: çŠ¶æ…‹å¤‰æ›è¡Œåˆ— x = T*z
        T_u: å…¥åŠ›å¤‰æ›è¡Œåˆ— u_full = T_u*u
    """
    # çŠ¶æ…‹å¤‰æ›è¡Œåˆ—Tï¼ˆæ‹˜æŸã‚’æº€ãŸã™ç‹¬ç«‹å¤‰æ•°ã¸ã®å¤‰æ›ï¼‰
    # ãƒ•ãƒ«çŠ¶æ…‹: x = [q; dq] âˆˆ R^20
    # ç¸®ç´„çŠ¶æ…‹: z = [independent_vars; independent_velocities] âˆˆ R^n
    
    # å…¥åŠ›å¤‰æ›è¡Œåˆ—T_uï¼ˆãƒˆãƒ«ã‚¯æ‹˜æŸã®ç·šå½¢è¿‘ä¼¼ï¼‰
    # f(theta1) = -0.00214*theta1^2 + 0.2636*theta1 - 8.4662
    # å¹³è¡¡ç‚¹52deg â‰ˆ 0.907 rad ã§ã®ç·šå½¢åŒ–
    f_eq = -0.00214 * 0.907**2 + 0.2636 * 0.907 - 8.4662  # â‰ˆ -8.228
    # tau2 = f_eq * tau1
```

#### 3.2 ç¸®ç´„ã‚·ã‚¹ãƒ†ãƒ è¡Œåˆ—è¨ˆç®—
```python
def compute_reduced_system(A_full, B_full, T, T_u):
    """
    ç¸®ç´„ã‚·ã‚¹ãƒ†ãƒ è¡Œåˆ—ã®è¨ˆç®—
    
    Args:
        A_full: ãƒ•ãƒ«ã‚·ã‚¹ãƒ†ãƒ è¡Œåˆ— (20Ã—20)
        B_full: ãƒ•ãƒ«å…¥åŠ›è¡Œåˆ— (20Ã—m)
        T: çŠ¶æ…‹å¤‰æ›è¡Œåˆ—
        T_u: å…¥åŠ›å¤‰æ›è¡Œåˆ—
        
    Returns:
        A_reduced: ç¸®ç´„ã‚·ã‚¹ãƒ†ãƒ è¡Œåˆ—
        B_reduced: ç¸®ç´„å…¥åŠ›è¡Œåˆ—
    """
    # ç¸®ç´„ã‚·ã‚¹ãƒ†ãƒ  dz/dt = A_reduced*z + B_reduced*u
    A_reduced = T.T @ A_full @ T
    B_reduced = T.T @ B_full @ T_u
    
    return A_reduced, B_reduced
```

### Phase 4: çŠ¶æ…‹ç©ºé–“ãƒ¢ãƒ‡ãƒ«ï¼ˆstate_space_model.pyï¼‰

#### 3.1 çŠ¶æ…‹ç©ºé–“è¡¨ç¾ã‚¯ãƒ©ã‚¹
```python
class LinearizedRobotModel:
    """ç·šå½¢åŒ–ãƒ­ãƒœãƒƒãƒˆãƒ¢ãƒ‡ãƒ«"""
    
    def __init__(self, A, B, C=None, D=None):
        self.A = A  # ã‚·ã‚¹ãƒ†ãƒ è¡Œåˆ—
        self.B = B  # å…¥åŠ›è¡Œåˆ—
        self.C = C if C is not None else np.eye(20)  # å‡ºåŠ›è¡Œåˆ—
        self.D = D if D is not None else np.zeros((20, B.shape[1]))
        
    def simulate(self, x0, u_func, t_span):
        """ç·šå½¢ã‚·ã‚¹ãƒ†ãƒ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³"""
        
    def step_response(self, input_channel=0):
        """ã‚¹ãƒ†ãƒƒãƒ—å¿œç­”è¨ˆç®—"""
        
    def frequency_response(self, omega_range):
        """å‘¨æ³¢æ•°å¿œç­”è¨ˆç®—"""
```

#### 3.2 åˆ¶å¾¡ç³»è¨­è¨ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
```python
def design_lqr_controller(model, Q, R):
    """LQRåˆ¶å¾¡å™¨è¨­è¨ˆ"""
    
def design_pole_placement(model, desired_poles):
    """æ¥µé…ç½®åˆ¶å¾¡å™¨è¨­è¨ˆ"""
    
def design_state_estimator(model, Q, R):
    """çŠ¶æ…‹æ¨å®šå™¨è¨­è¨ˆ"""
```

### Phase 4: ã‚·ã‚¹ãƒ†ãƒ è§£æï¼ˆlinear_analysis.pyï¼‰

#### 4.1 åˆ¶å¾¡ç†è«–è§£æ
```python
def analyze_controllability(A, B):
    """å¯åˆ¶å¾¡æ€§è§£æ"""
    # å¯åˆ¶å¾¡æ€§è¡Œåˆ—ã®ãƒ©ãƒ³ã‚¯è¨ˆç®—
    # PBH test
    
def analyze_observability(A, C):
    """å¯è¦³æ¸¬æ€§è§£æ"""
    # å¯è¦³æ¸¬æ€§è¡Œåˆ—ã®ãƒ©ãƒ³ã‚¯è¨ˆç®—
    
def analyze_stability(A):
    """å®‰å®šæ€§è§£æ"""
    # å›ºæœ‰å€¤è¨ˆç®—ã¨å®‰å®šæ€§åˆ¤å®š
    # Lyapunovæ–¹ç¨‹å¼ã«ã‚ˆã‚‹å®‰å®šæ€§è¨¼æ˜
```

#### 4.2 å‘¨æ³¢æ•°é ˜åŸŸè§£æ
```python
def compute_transfer_function(A, B, C, D):
    """ä¼é”é–¢æ•°è¨ˆç®—"""
    
def plot_bode_diagram(model):
    """ãƒœãƒ¼ãƒ‰ç·šå›³ä½œæˆ"""
    
def plot_nyquist_diagram(model):
    """ãƒŠã‚¤ã‚­ã‚¹ãƒˆç·šå›³ä½œæˆ"""
```

### Phase 5: æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ ï¼ˆcomparison_test.pyï¼‰

#### 5.1 ç²¾åº¦æ¤œè¨¼
```python
def compare_nonlinear_vs_linear(robot_nl, robot_l, test_scenarios):
    """éç·šå½¢vsç·šå½¢ãƒ¢ãƒ‡ãƒ«æ¯”è¼ƒ"""
    
    scenarios = [
        {"name": "å°æŒ¯å¹…å¤–ä¹±", "x0": small_perturbation, "duration": 5.0},
        {"name": "ä¸­æŒ¯å¹…å¤–ä¹±", "x0": medium_perturbation, "duration": 3.0},
        {"name": "ã‚¹ãƒ†ãƒƒãƒ—å…¥åŠ›", "input": step_input, "duration": 10.0}
    ]
    
    for scenario in scenarios:
        # éç·šå½¢ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        # ç·šå½¢ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        # èª¤å·®è§£æ
        # å¯è¦–åŒ–
```

#### 5.2 æœ‰åŠ¹æ€§è©•ä¾¡
```python
def evaluate_linearization_validity():
    """ç·šå½¢åŒ–ã®æœ‰åŠ¹æ€§è©•ä¾¡"""
    
    # ç·šå½¢åŒ–èª¤å·®ã®å®šé‡è©•ä¾¡
    # æœ‰åŠ¹é ˜åŸŸã®æ¨å®š
    # é©ç”¨é™ç•Œã®ç‰¹å®š
```

## æŠ€è¡“çš„è©³ç´°

### CasADiè‡ªå‹•å¾®åˆ†ã‚·ã‚¹ãƒ†ãƒ 

#### CasADi-Pinocchioé€£æº
```python
import casadi as cs
import pinocchio as pin

# CasADiã‚·ãƒ³ãƒœãƒªãƒƒã‚¯å¤‰æ•°ã‹ã‚‰Pinocchioè¨ˆç®—
def pinocchio_dynamics_casadi(q_sym, dq_sym, tau_sym):
    """CasADiå¤‰æ•°ã‚’ä½¿ã£ãŸPinocchioå‹•åŠ›å­¦è¨ˆç®—"""
    # ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯å¤‰æ•°ã‚’æ•°å€¤é…åˆ—ã«å¤‰æ›
    q_num = cs.DM(q_sym)
    dq_num = cs.DM(dq_sym)
    tau_num = cs.DM(tau_sym)
    
    # Pinocchioè¨ˆç®—ï¼ˆæ•°å€¤ï¼‰
    M = pin.crba(model, data, q_num)
    g = pin.computeGeneralizedGravity(model, data, q_num)
    C = pin.computeCoriolisMatrix(model, data, q_num, dq_num)
    
    # é‹å‹•æ–¹ç¨‹å¼: ddq = M^-1(tau - g - C*dq)
    ddq = cs.solve(M, tau_num - g - C @ dq_num)
    
    return cs.vertcat(dq_sym, ddq)
```

#### è‡ªå‹•å¾®åˆ†ã«ã‚ˆã‚‹ç·šå½¢åŒ–
```python
# çŠ¶æ…‹æ–¹ç¨‹å¼ dx/dt = f(x, u)
x_sym = cs.vertcat(q_sym, dq_sym)  # çŠ¶æ…‹ãƒ™ã‚¯ãƒˆãƒ«
f_sym = pinocchio_dynamics_casadi(q_sym, dq_sym, tau_sym)

# ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ï¼ˆè‡ªå‹•å¾®åˆ†ï¼‰
A_sym = cs.jacobian(f_sym, x_sym)  # âˆ‚f/âˆ‚x
B_sym = cs.jacobian(f_sym, tau_sym)  # âˆ‚f/âˆ‚u

# é–¢æ•°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
A_func = cs.Function('A', [x_sym, tau_sym], [A_sym])
B_func = cs.Function('B', [x_sym, tau_sym], [B_sym])
```

### Pinocchio APIæ´»ç”¨

#### é †é‹å‹•å­¦ãƒ»å‹•åŠ›å­¦
```python
# æ…£æ€§è¡Œåˆ—
M = pin.crba(model, data, q)

# é‡åŠ›é …
g = pin.computeGeneralizedGravity(model, data, q)

# ã‚³ãƒªã‚ªãƒªé …
C = pin.computeCoriolisMatrix(model, data, q, dq)
```

### æ•°å€¤è¨ˆç®—æ‰‹æ³•

#### ç·šå½¢åŒ–è¨ˆç®—
```python
# ä¸­å¤®å·®åˆ†æ³•
def central_difference(f, x, h=1e-8):
    return (f(x + h) - f(x - h)) / (2 * h)

# å¤šæ§˜ä½“ä¸Šã®å¾®åˆ†
def manifold_difference(manifold, q1, q2):
    return pin.difference(model, q1, q2)
```

#### è¡Œåˆ—åˆ†è§£
```python
# ç‰¹ç•°å€¤åˆ†è§£ï¼ˆæ•°å€¤å®‰å®šæ€§ï¼‰
U, s, Vt = np.linalg.svd(matrix)

# QRåˆ†è§£ï¼ˆåˆ¶å¾¡å¯èƒ½æ€§è§£æï¼‰
Q, R = np.linalg.qr(controllability_matrix)
```

## å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆï¼ˆæ•´ç†å¾Œï¼‰

```
src/test/linearized_3d_robot/
â”œâ”€â”€ linearized_3d_robot.md                  # æœ¬æ–‡æ›¸ï¼ˆå®Œå…¨çµ±åˆç‰ˆï¼‰
â”œâ”€â”€ equilibrium_finder.py                   # âœ… å¹³è¡¡ç‚¹æ¢ç´¢ï¼ˆæŒ‡å®šå¹³è¡¡ç‚¹è¨ˆç®—ï¼‰
â”œâ”€â”€ linearized_dynamics.py                  # âœ… CasADiç·šå½¢åŒ–å‹•åŠ›å­¦ï¼ˆè‡ªå‹•å¾®åˆ†ï¼‰
â”œâ”€â”€ linearized_dynamics_simple.py           # âœ… æ•°å€¤å¾®åˆ†ç·šå½¢åŒ–ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç‰ˆï¼‰
â”œâ”€â”€ constraint_reduction.py                 # âœ… å¹¾ä½•å­¦çš„æ‹˜æŸç¸®ç´„ï¼ˆçŠ¶æ…‹ãƒ»å…¥åŠ›å¤‰æ›ï¼‰
â”œâ”€â”€ controllability_analysis.py             # âœ… åˆ¶å¾¡å¯èƒ½æ€§è§£æï¼ˆè©³ç´°ç‰ˆï¼‰
â”œâ”€â”€ controllability_analysis_main.py        # âœ… åˆ¶å¾¡å¯èƒ½æ€§è§£æï¼ˆPKLèª­è¾¼å®Ÿè¡Œç‰ˆï¼‰
â”œâ”€â”€ test_linearization.py                  # âœ… çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆCasADi+PKLä¿å­˜ï¼‰
â””â”€â”€ linearization_results.pkl               # âœ… ç·šå½¢åŒ–çµæœï¼ˆä¿å­˜æ¸ˆã¿ï¼‰

# ãƒ•ãƒ­ãƒ¼
1. test_linearization.py â†’ CasADiç·šå½¢åŒ– â†’ PKLä¿å­˜
2. controllability_analysis_main.py â†’ PKLèª­è¾¼ â†’ åˆ¶å¾¡å¯èƒ½æ€§ç¢ºèª
```

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å›³

```
[equilibrium_finder.py] 
    â†“ å¹³è¡¡ç‚¹è¨ˆç®—
[linearized_dynamics.py] (CasADiè‡ªå‹•å¾®åˆ†)
    â†“ A_full, B_full 
[constraint_reduction.py] 
    â†“ A_reduced, B_reduced
[test_linearization.py] â†’ linearization_results.pkl
    â†“ PKLä¿å­˜
[controllability_analysis_main.py] 
    â†“ PKLèª­è¾¼
åˆ¶å¾¡å¯èƒ½æ€§ç¢ºèª: ãƒ©ãƒ³ã‚¯16/16 âœ…
```

## é”æˆã•ã‚ŒãŸæˆæœ

### ç†è«–çš„æˆæœ âœ…
1. **16æ¬¡å…ƒç¸®ç´„çŠ¶æ…‹æ–¹ç¨‹å¼**: `dz/dt = A_reduced*z + B_reduced*u`
2. **åˆ¶å¾¡ç†è«–åŸºç›¤**: LQR, æ¥µé…ç½®, çŠ¶æ…‹æ¨å®šå™¨è¨­è¨ˆåŸºç›¤å®Œæˆ
3. **ã‚·ã‚¹ãƒ†ãƒ ç‰¹æ€§è§£æ**: å®Œå…¨åˆ¶å¾¡å¯èƒ½æ€§ç¢ºèªã€å®‰å®šæ¥µé…ç½®æˆåŠŸ

### å®Ÿç”¨çš„æˆæœ âœ…
1. **åˆ¶å¾¡å™¨è¨­è¨ˆ**: ç·šå½¢åˆ¶å¾¡ç†è«–ã®ç›´æ¥é©ç”¨å¯èƒ½
2. **è§£æãƒ„ãƒ¼ãƒ«**: åˆ¶å¾¡å¯èƒ½æ€§è§£æã€æ¥µé…ç½®åˆ¶å¾¡å®Ÿè£…
3. **ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: ç¸®ç´„ç·šå½¢ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚‹é«˜é€Ÿè¨ˆç®—

### æŠ€è¡“çš„æ„ç¾© âœ…
1. **Pinocchioç·šå½¢åŒ–**: CasADiè‡ªå‹•å¾®åˆ†ã«ã‚ˆã‚‹ä½“ç³»çš„ç·šå½¢åŒ–å®Ÿç¾
2. **åˆ¶å¾¡å·¥å­¦çµ±åˆ**: ãƒ­ãƒœãƒ†ã‚£ã‚¯ã‚¹ã¨åˆ¶å¾¡ç†è«–ã®å®Œå…¨çµ±åˆ
3. **å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³**: å¹¾ä½•å­¦çš„æ‹˜æŸè€ƒæ…®ã®æ±ç”¨ç·šå½¢åŒ–ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

## æˆåŠŸæŒ‡æ¨™é”æˆçŠ¶æ³
- âœ… **å¹³è¡¡ç‚¹åæŸ**: æŒ‡å®šæ¡ä»¶(52deg/-104deg)å®Œå…¨æº€è¶³
- âœ… **æ‹˜æŸæº€è¶³**: å¹¾ä½•å­¦çš„æ‹˜æŸèª¤å·® 0.000000e+00
- âœ… **åˆ¶å¾¡å¯èƒ½æ€§**: ç¸®ç´„ã‚·ã‚¹ãƒ†ãƒ 16æ¬¡å…ƒãƒ•ãƒ«ãƒ©ãƒ³ã‚¯ç¢ºèª
- âœ… **ç·šå½¢åˆ¶å¾¡å™¨è¨­è¨ˆ**: æ¥µé…ç½®åˆ¶å¾¡å™¨è¨­è¨ˆæˆåŠŸ
- âœ… **çŠ¶æ…‹æ–¹ç¨‹å¼æ§‹ç¯‰**: ç¸®ç´„ãƒ¢ãƒ‡ãƒ« `dz/dt = A_reduced*z + B_reduced*u` å®Œæˆ

## ğŸ¯ é‡è¦ãªå®Ÿè£…çµæœ

### åˆ¶å¾¡ç†è«–çš„çµè«–
**3Dãƒ•ãƒ«ãƒ­ãƒœãƒƒãƒˆç¸®ç´„ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ16æ¬¡å…ƒï¼‰ã¯å®Œå…¨åˆ¶å¾¡å¯èƒ½**
- åˆ¶å¾¡å¯èƒ½æ€§è¡Œåˆ—ãƒ©ãƒ³ã‚¯: 16/16 âœ…
- æ¥µé…ç½®åˆ¶å¾¡: ä»»æ„å®‰å®šæ¥µé…ç½®æˆåŠŸ âœ…  
- LQRåˆ¶å¾¡é©ç”¨: å¯èƒ½ âœ…
- çŠ¶æ…‹ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åˆ¶å¾¡: é©ç”¨å¯èƒ½ âœ…

### å®Ÿè£…ã•ã‚ŒãŸAPIï¼ˆçµ±åˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼‰
```python
# çµ±åˆå®Ÿè¡Œï¼ˆtest_linearization.pyï¼‰
from equilibrium_finder import EquilibriumFinder
from linearized_dynamics import LinearizedDynamics  # CasADiè‡ªå‹•å¾®åˆ†ç‰ˆ
from constraint_reduction import ConstraintReduction

# çµ±åˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œ
tester = LinearizationIntegrationTest()
results = tester.run_full_pipeline()

# çµæœä¿å­˜ï¼ˆPKLãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
import pickle
with open('linearization_results.pkl', 'wb') as f:
    pickle.dump(results, f)
```

### åˆ¶å¾¡å¯èƒ½æ€§è§£æï¼ˆæœ¬ç‰©ã®çµæœï¼‰
```python
# ä¿å­˜ã•ã‚ŒãŸçµæœã‹ã‚‰åˆ¶å¾¡å¯èƒ½æ€§ç¢ºèªï¼ˆcontrollability_analysis_main.pyï¼‰
import pickle
import numpy as np

with open('linearization_results.pkl', 'rb') as f:
    data = pickle.load(f)

A_reduced = data['reduced_system']['A']  # (16, 16)
B_reduced = data['reduced_system']['B']  # (16, 8)

# åˆ¶å¾¡å¯èƒ½æ€§è¡Œåˆ—æ§‹ç¯‰
n = A_reduced.shape[0]
C_matrix = np.hstack([B_reduced] + [np.linalg.matrix_power(A_reduced, i) @ B_reduced for i in range(1, n)])

rank = np.linalg.matrix_rank(C_matrix)
is_controllable = (rank == n)  # True: 16/16 âœ…
```

---

## æ¬¡æœŸç™ºå±•è¨ˆç”»

### åˆ¶å¾¡å™¨å®Ÿè£…
1. **LQRåˆ¶å¾¡å™¨**: æœ€é©åˆ¶å¾¡ç†è«–å¿œç”¨
2. **ãƒ­ãƒã‚¹ãƒˆåˆ¶å¾¡**: Hâˆåˆ¶å¾¡, Î¼è¨­è¨ˆ
3. **äºˆæ¸¬åˆ¶å¾¡**: MPC (Model Predictive Control)

### éç·šå½¢æ‹¡å¼µ
1. **é«˜æ¬¡ç·šå½¢åŒ–**: 2æ¬¡, 3æ¬¡é …ã®è€ƒæ…®
2. **åŒºåˆ†ç·šå½¢åŒ–**: å‹•ä½œé ˜åŸŸåˆ¥ç·šå½¢åŒ–
3. **é©å¿œç·šå½¢åŒ–**: ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ç·šå½¢åŒ–æ›´æ–°

### å®Ÿæ©Ÿé©ç”¨
1. **åŒå®šå®Ÿé¨“**: å®Ÿæ©Ÿãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒå®š
2. **åˆ¶å¾¡å®Ÿè£…**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ¶å¾¡å®Ÿè£…
3. **æ€§èƒ½è©•ä¾¡**: å®Ÿæ©Ÿåˆ¶å¾¡æ€§èƒ½è©•ä¾¡

---

## ğŸ† ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç·æ‹¬

### é”æˆã—ãŸæŠ€è¡“çš„ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³
1. **3æ¬¡å…ƒäºŒè¶³æ­©è¡Œãƒ­ãƒœãƒƒãƒˆã®å®Œå…¨ç·šå½¢åŒ–**: éç·šå½¢å‹•åŠ›å­¦ â†’ ç·šå½¢çŠ¶æ…‹æ–¹ç¨‹å¼
2. **å¹¾ä½•å­¦çš„æ‹˜æŸã®ä½“ç³»çš„å‡¦ç†**: `theta2 = -2*theta1` åˆ¶ç´„ä¸‹ã§ã®ç¸®ç´„ãƒ¢ãƒ‡ãƒ«
3. **åˆ¶å¾¡ç†è«–ã¨ã®å®Œå…¨çµ±åˆ**: åˆ¶å¾¡å¯èƒ½æ€§ç¢ºèª â†’ åˆ¶å¾¡å™¨è¨­è¨ˆåŸºç›¤å®Œæˆ
4. **å®Ÿç”¨çš„APIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã•ã‚ŒãŸå†åˆ©ç”¨å¯èƒ½ã‚·ã‚¹ãƒ†ãƒ 

### å·¥å­¦çš„ä¾¡å€¤
- **ç†è«–**: ãƒ­ãƒœãƒƒãƒˆå‹•åŠ›å­¦ã®ç·šå½¢åˆ¶å¾¡ç†è«–ã¸ã®æ©‹æ¸¡ã—
- **å®Ÿè£…**: Pinocchio + CasADi + åˆ¶å¾¡ç†è«–ã®çµ±åˆãƒ‘ã‚¿ãƒ¼ãƒ³
- **å¿œç”¨**: ä»–ã®æ‹˜æŸä»˜ããƒ­ãƒœãƒƒãƒˆã‚·ã‚¹ãƒ†ãƒ ã¸ã®å±•é–‹å¯èƒ½æ€§

### åˆ¶å¾¡å·¥å­¦çš„çµè«–
**3Dãƒ•ãƒ«ãƒ­ãƒœãƒƒãƒˆã¯ç·šå½¢åˆ¶å¾¡ç†è«–ã«ã‚ˆã‚Šåˆ¶å¾¡å¯èƒ½**
- âœ… å®Œå…¨åˆ¶å¾¡å¯èƒ½æ€§ç¢ºèªæ¸ˆã¿
- âœ… LQRãƒ»æ¥µé…ç½®ãƒ»çŠ¶æ…‹ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åˆ¶å¾¡é©ç”¨å¯èƒ½
- âœ… ç¾ä»£åˆ¶å¾¡ç†è«–ã®ç›´æ¥é©ç”¨åŸºç›¤å®Œæˆ

---

## ğŸ¯ ç·šå½¢åŒ–çµæœã®åˆ©ç”¨æ–¹æ³•

### çµæœãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€
```
src/test/linearized_3d_robot/linearization_results.pkl
```

### PKLãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹æ§‹é€ 
```python
results = {
    'equilibrium': {
        'q_eq': np.array,           # å¹³è¡¡ç‚¹ä½ç½® (10æ¬¡å…ƒ)
        'dq_eq': np.array,          # å¹³è¡¡ç‚¹é€Ÿåº¦ (10æ¬¡å…ƒ) 
        'tau_eq': np.array,         # å¹³è¡¡ç‚¹ãƒˆãƒ«ã‚¯ (10æ¬¡å…ƒ)
        'upper_angle_deg': float,   # ä¸Šè…¿è§’åº¦ 52.0deg
        'lower_angle_deg': float,   # ä¸‹è…¿è§’åº¦ -104.0deg
    },
    'full_system': {
        'A': np.array,              # ãƒ•ãƒ«ã‚·ã‚¹ãƒ†ãƒ è¡Œåˆ— (20Ã—20)
        'B': np.array,              # ãƒ•ãƒ«å…¥åŠ›è¡Œåˆ— (20Ã—10)
    },
    'reduced_system': {
        'A': np.array,              # ç¸®ç´„ã‚·ã‚¹ãƒ†ãƒ è¡Œåˆ— (16Ã—16) â†LQRè¨­è¨ˆã§ä½¿ç”¨
        'B': np.array,              # ç¸®ç´„å…¥åŠ›è¡Œåˆ— (16Ã—8)   â†LQRè¨­è¨ˆã§ä½¿ç”¨
    },
    'transformation': {
        'T': np.array,              # çŠ¶æ…‹å¤‰æ›è¡Œåˆ— (16Ã—20)
        'T_u': np.array,            # å…¥åŠ›å¤‰æ›è¡Œåˆ— (8Ã—10)
    }
}
```

## ğŸ® æ¬¡ã®LQRåˆ¶å¾¡å®Ÿè£…ã‚¬ã‚¤ãƒ‰

### 1. LQRåˆ¶å¾¡å™¨è¨­è¨ˆã®åŸºæœ¬å½¢
```python
import pickle
import numpy as np
from scipy.linalg import solve_continuous_are

# ç·šå½¢åŒ–çµæœèª­ã¿è¾¼ã¿
with open('linearization_results.pkl', 'rb') as f:
    data = pickle.load(f)

# ç¸®ç´„ã‚·ã‚¹ãƒ†ãƒ å–å¾—ï¼ˆLQRè¨­è¨ˆã§ä½¿ç”¨ï¼‰
A = data['reduced_system']['A']  # (16, 16)
B = data['reduced_system']['B']  # (16, 8)

# LQRé‡ã¿è¡Œåˆ—è¨­å®š
Q = np.eye(16)  # çŠ¶æ…‹ã‚³ã‚¹ãƒˆè¡Œåˆ—
R = np.eye(8)   # å…¥åŠ›ã‚³ã‚¹ãƒˆè¡Œåˆ—

# ãƒªã‚«ãƒƒãƒæ–¹ç¨‹å¼æ±‚è§£
P = solve_continuous_are(A, B, Q, R)

# LQRã‚²ã‚¤ãƒ³è¨ˆç®—  
K = np.linalg.inv(R) @ B.T @ P  # (8, 16)

# åˆ¶å¾¡å‰‡: u = -K @ z (zã¯ç¸®ç´„çŠ¶æ…‹)
```

### 2. å®Ÿæ©Ÿé©ç”¨æ™‚ã®çŠ¶æ…‹å¤‰æ›
```python
# ãƒ•ãƒ«çŠ¶æ…‹ â†’ ç¸®ç´„çŠ¶æ…‹å¤‰æ›
def full_to_reduced_state(x_full, T):
    """ãƒ•ãƒ«çŠ¶æ…‹(20æ¬¡å…ƒ) â†’ ç¸®ç´„çŠ¶æ…‹(16æ¬¡å…ƒ)"""
    return T @ x_full

# ç¸®ç´„å…¥åŠ› â†’ ãƒ•ãƒ«å…¥åŠ›å¤‰æ›  
def reduced_to_full_input(u_reduced, T_u):
    """ç¸®ç´„å…¥åŠ›(8æ¬¡å…ƒ) â†’ ãƒ•ãƒ«å…¥åŠ›(10æ¬¡å…ƒ)"""
    return T_u.T @ u_reduced

# å®Ÿæ©Ÿåˆ¶å¾¡ãƒ«ãƒ¼ãƒ—
T = data['transformation']['T']      # çŠ¶æ…‹å¤‰æ›è¡Œåˆ—
T_u = data['transformation']['T_u']  # å…¥åŠ›å¤‰æ›è¡Œåˆ—

# åˆ¶å¾¡ãƒ«ãƒ¼ãƒ—
x_full = get_current_state()         # ç¾åœ¨ã®çŠ¶æ…‹å–å¾—(20æ¬¡å…ƒ)
z = full_to_reduced_state(x_full, T) # ç¸®ç´„çŠ¶æ…‹ã¸å¤‰æ›(16æ¬¡å…ƒ)
u_reduced = -K @ z                   # LQRåˆ¶å¾¡å…¥åŠ›è¨ˆç®—(8æ¬¡å…ƒ)
u_full = reduced_to_full_input(u_reduced, T_u)  # ãƒ•ãƒ«å…¥åŠ›ã¸å¤‰æ›(10æ¬¡å…ƒ)
apply_control(u_full)                # å®Ÿæ©Ÿã«åˆ¶å¾¡å…¥åŠ›é©ç”¨
```

### 3. æ¨å¥¨LQRè¨­è¨ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
```python
# ä½ç½®ãƒ»å§¿å‹¢é‡è¦–è¨­å®š
Q = np.diag([
    # ä½ç½®æˆåˆ† (x, y, pitch, yaw)
    100, 100, 1000, 100,    # ä½ç½®ãƒ»å§¿å‹¢é‡è¦–
    # é–¢ç¯€è§’åº¦æˆåˆ† (ä¸‹è…¿L, ä¸‹è…¿R, ä¸Šè…¿L, ä¸Šè…¿R)  
    10, 10, 10, 10,         # é–¢ç¯€è§’åº¦åˆ¶å¾¡
    # é€Ÿåº¦æˆåˆ† (8æ¬¡å…ƒ)
    1, 1, 1, 1, 1, 1, 1, 1  # é€Ÿåº¦æŠ‘åˆ¶
])

R = np.diag([
    # é–¢ç¯€ãƒˆãƒ«ã‚¯åˆ¶ç´„ (8æ¬¡å…ƒ)
    0.1, 0.1, 0.1, 0.1,     # é–¢ç¯€ãƒˆãƒ«ã‚¯ç¯€ç´„
    1, 1, 1, 1              # ãã®ä»–å…¥åŠ›
])
```

### 4. å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«æ¨å¥¨æ§‹æˆ
```
src/test/linearized_3d_robot/
â”œâ”€â”€ lqr_controller.py              # LQRåˆ¶å¾¡å™¨è¨­è¨ˆãƒ»å®Ÿè£…
â”œâ”€â”€ state_feedback_sim.py          # ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç’°å¢ƒ
â””â”€â”€ real_time_control.py           # å®Ÿæ©Ÿåˆ¶å¾¡ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
```

ã“ã®ç·šå½¢åŒ–çµæœã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€è¤‡é›‘ãª3æ¬¡å…ƒäºŒè¶³æ­©è¡Œãƒ­ãƒœãƒƒãƒˆã«å¯¾ã—ã¦æœ€é©åˆ¶å¾¡ç†è«–ã‚’ç›´æ¥é©ç”¨ã§ãã¾ã™ã€‚

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚ˆã‚Šã€è¤‡é›‘ãª3æ¬¡å…ƒãƒ­ãƒœãƒƒãƒˆå‹•åŠ›å­¦ã«å¯¾ã™ã‚‹ä½“ç³»çš„ãªç·šå½¢åˆ¶å¾¡ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒç¢ºç«‹ã•ã‚Œã¾ã—ãŸã€‚