# URDF Single Leg 実装プラン

## 概要
mimic_v1_single_leg.urdfモデルを使用した拘束付き動力学シミュレーション

## モデル構成

### フローティングベースの全自由度（3次元）
- **Pinocchioの3次元空間での表現**: 6自由度
  - x方向並進
  - y方向並進
  - z方向並進
  - x軸周り回転（roll）
  - y軸周り回転（pitch）
  - z軸周り回転（yaw）

### フローティングベースの拘束済み自由度（3次元）
- **2D平面拘束の適用後**: 3自由度
  - x方向並進（自由）
  - z方向並進（自由）
  - y軸周り回転/pitch（自由）
  - ※y方向並進、roll、yawは拘束により固定

### その他リンクとホイールの全自由度（3次元）
- **upper_link_R_joint**: 股関節（y軸周り回転）- 1自由度
- **lower_link_R_joint**: 膝関節（y軸周り回転）- 1自由度
- **wheel_R_joint**: ホイール（y軸周り回転）- 1自由度
- **合計**: 3自由度

### その他リンクとホイールの拘束済み自由度（3次元）
- **拘束条件**: なし（全関節が独立に動作可能）
- **拘束済み自由度**: 3自由度

### 総合的な自由度計算
- **全自由度**: フローティングベース3 + 関節3 = 6自由度
- **接地拘束**: ホイール底面が常に地面に接触（-1自由度）
- **no-slip拘束**: 実装予定（-1自由度）
- **実効自由度**: 6 - 2 = 4自由度

- **リンク構造**: base_link → upper_link_R → lower_link_R → wheel_R

## 実装方針

### 1. システムのモデリング
- URDFからPinocchioモデルを構築（FreeFlyer付き）
- フローティングベース＋3関節のロボットとしてモデル化
- タイヤ（wheel_R）の接地点を拘束として扱う

### 2. 拘束条件
- タイヤは地面から絶対に浮かない（z座標が常に一定）
- no-slip拘束：ホイールの回転速度と水平移動速度の関係を強制
- この2つの拘束により自由度が6から4に減少する
- simple_testと同様の拘束単純化アプローチを採用

### 3. 動力学計算
- Pinocchioを使用した運動方程式の導出
- 拘束による縮約を実施
- 重力のみの自由応答をシミュレート（制御なし）

### 4. 期待される動作
- ボディ（base_link）が重力で落下
- タイヤが地面に固定されているため、3重振り子のような挙動
- フローティングベース＋3関節による複雑な振動パターン

## 実装ステップ
1. URDFモデルの読み込みと初期可視化
2. 拘束条件の数式化
3. 初期姿勢の計算（タイヤ接地を満たす姿勢）
4. 運動方程式の導出（Pinocchio使用）
5. 拘束による縮約（自由度削減）
6. 数値積分によるシミュレーション
7. 2Dアニメーション作成

## 技術的詳細
- Pinocchio APIの活用
- 拘束はヤコビアンを使用して表現
- 数値積分にはRunge-Kutta法を使用予定