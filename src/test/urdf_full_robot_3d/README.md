# URDF Full Robot 3D

3次元空間でのフルロボット（**mimic_v1.urdf**）拘束付き動力学シミュレーション。single_legプロジェクトで実証された高精度ノンスリップ拘束手法を、左右両脚を持つ二足歩行ロボットに拡張。

## 概要

### プロジェクト目標
- single_leg（1脚・2D）→ full_robot（2脚・3D）への技術スケーリング
- 左右両輪の同時ノンスリップ拘束実現
- 3次元空間での高精度動力学シミュレーション

### 使用モデル
- **URDFファイル**: `urdf/mimic_v1.urdf`
- **ロボット構成**: 
  - フローティングベース
  - 左脚: 股関節→膝関節→ホイール
  - 右脚: 股関節→膝関節→ホイール
- **総質量**: 約7.1kg

## システム仕様

### 自由度構成
| 要素 | 自由度数 | 説明 |
|------|----------|------|
| フローティングベース | 6 | x,y,z並進 + roll,pitch,yaw回転 |
| 関節 | 6 | 左右各3関節（股・膝・ホイール） |
| **総自由度** | **12** | - |
| 拘束条件 | -4 | 左右接地(2) + 左右ノンスリップ(2) |
| **実効自由度** | **8** | 独立に制御可能な自由度 |

### 拘束条件
1. **接地拘束**: 左右ホイール底面が地面（z=0）に接触
2. **ノンスリップ拘束**: ホイール中心移動距離 = タイヤ回転距離（左右独立）

## ファイル構成（予定）

```
urdf_full_robot_3d/
├── README.md                 # このファイル
├── urdf_full_robot_3d.md    # 詳細設計書
├── dynamics_3d.py           # 動力学計算モジュール
├── constraints_3d.py        # 拘束条件処理
├── animation_3d.py          # 3D可視化
├── verification_3d.py       # 拘束精度検証
├── main_simulation.py       # メインプログラム
└── test_scenarios.py        # テストケース集
```

## 使用方法

### 環境準備
```bash
# 仮想環境のアクティベート（必須）
. bin/activate

# 必要なライブラリ確認
python -c "import pinocchio; print('Pinocchio OK')"
```

### 基本実行（予定）
```bash
cd src/test/urdf_full_robot_3d

# 基本シミュレーション
python main_simulation.py

# カスタム初期条件
python main_simulation.py --phi_L_upper 0.4 --phi_L_lower -0.8

# 検証モード
python verification_3d.py
```

### 出力ファイル（予定）
- `robot_3d_animation.gif`: 3Dアニメーション
- `constraint_verification_3d.png`: 拘束精度グラフ
- `simulation_results_3d.pkl`: 検証用データ

## 技術的特徴

### Single_legからの継承
- ✅ **位置ベース拘束**: タイヤ角度を位置から直接計算
- ✅ **累積角度追跡**: 2π跨ぎ問題の解決済み
- ✅ **高精度実現**: 機械精度レベル（10^-16）
- ✅ **モジュール設計**: 計算・表示・検証の分離

### 3D拡張の新要素
- 🆕 **3次元姿勢決定**: 2接地点からroll/pitchを計算
- 🆕 **左右連成効果**: 両脚の相互作用考慮
- 🆕 **4拘束同時解法**: 安定な数値解法
- 🆕 **3D可視化**: matplotlib 3Dアニメーション

## 期待される動作

### 初期状態
- ロボットが左右非対称な姿勢で直立
- 両ホイールが地面に接地

### シミュレーション中
- 重力による自由落下開始
- 両脚が連成した3次元振り子運動
- ホイールが滑らずに正確に回転
- 姿勢角（roll/pitch/yaw）の自然な変動

### 物理的特性
- エネルギー保存（摩擦なし）
- 運動量保存（外力は重力のみ）
- 拘束条件の常時満足

## 開発状況

### 完了項目
- ✅ プロジェクトフォルダ作成
- ✅ 詳細設計書（urdf_full_robot_3d.md）
- ✅ README.md（このファイル）

### 進行中
- 🔄 基本モデル読み込み実装
- 🔄 拘束システム設計

### 今後の予定
- ⏳ 動力学計算実装
- ⏳ 3Dアニメーション開発
- ⏳ 検証システム構築
- ⏳ テストケース作成

## 参考情報

### 関連プロジェクト
1. **single_legプロジェクト**
   - 場所: `src/test/urdf_single_leg/`
   - 内容: 1脚2Dノンスリップ拘束（基礎技術）

2. **full_robot_dynamicsプロジェクト**
   - 場所: `src/test/full_robot_dynamics/`
   - 内容: 2脚接地拘束（参考実装）

### 技術文書
- Pinocchio公式ドキュメント
- `CLAUDE.md`: プロジェクト共通ガイドライン
- `urdf/model_info.md`: ロボットモデル詳細

## 注意事項

- 仮想環境のアクティベートを忘れずに
- URDFパスは`urdf/mimic_v1.urdf`を使用
- 数値積分の時間刻みは安定性を考慮して選択
- 初期姿勢は拘束を満たすよう慎重に設定

## ライセンス
プロジェクト内部使用のみ